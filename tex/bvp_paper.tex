%\documentclass[iop]{emulateapj}
\documentclass[aps, pre, onecolumn, nofootinbib, notitlepage, groupedaddress, amsfonts, amssymb, amsmath, longbibliography]{revtex4-1}
\usepackage{tabularx}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{xcolor}
\hypersetup{
    colorlinks,
    linkcolor={red!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}
}
\usepackage{bm}
\usepackage{natbib}
\usepackage{longtable}
\LTcapwidth=0.87\textwidth

\newcommand{\Div}[1]{\ensuremath{\nabla\cdot\left( #1\right)}}
\newcommand{\DivU}{\ensuremath{\nabla\cdot\bm{u}}}
\newcommand{\angles}[1]{\ensuremath{\left\langle #1 \right\rangle}}
\newcommand{\grad}{\ensuremath{\nabla}}
\newcommand{\RB}{Rayleigh-B\'{e}nard }
\newcommand{\stressT}{\ensuremath{\bm{\bar{\bar{\Pi}}}}}
\newcommand{\lilstressT}{\ensuremath{\bm{\bar{\bar{\sigma}}}}}
\newcommand{\nrho}{\ensuremath{n_{\rho}}}
\newcommand{\approptoinn}[2]{\mathrel{\vcenter{
	\offinterlineskip\halign{\hfil$##$\cr
	#1\propto\cr\noalign{\kern2pt}#1\sim\cr\noalign{\kern-2pt}}}}}

\newcommand{\appropto}{\mathpalette\approptoinn\relax}

\newcommand\mnras{{MNRAS}}%

\begin{document}
\author{Evan H. Anders}
\affiliation{Dept. Astrophysical \& Planetary Sciences, University of Colorado -- Boulder, Boulder, CO 80309, USA}
\affiliation{Laboratory for Atmospheric and Space Physics, Boulder, CO 80303, USA}
\author{Benjamin P. Brown}
\affiliation{Dept. Astrophysical \& Planetary Sciences, University of Colorado -- Boulder, Boulder, CO 80309, USA}
\affiliation{Laboratory for Atmospheric and Space Physics, Boulder, CO 80303, USA}
\author{Jeffrey S. Oishi}
\affiliation{Department of Physics and Astronomy, Bates College, Lewiston, ME 04240, USA}
\title{Accelerated evolution of convective simulations}

\begin{abstract}
We present a method for coupling boundary value problems with initial value problems 
in order to achieve Accelerated Evolution (AE) of convective solutions on
dynamical timescales, rather than the long thermal timescale. 
We study this method in the context of \RB convection. 
We demonstrate that the solution reached by AE and Standard Evolution (SE) are
similar, and that this method works at a
large range of supercriticalities.  The AE method is used to achieve converged 
solutions at high supercriticality ($10^7$), and its extensions to more complex 
systems are briefly discussed.
\end{abstract}
\maketitle

%%%%%%%%%%%%
%%%%%%%%%%%
% INTRO
%%%%%%%%%%%
%%%%%%%%%%%%

\section{Introduction}
\label{sec:intro}
Natural convection occurs in the presence of disparate timescales which
prohibit numericists from studying realistic models of natural systems.  For example,
flows in the convection zone of stars like the Sun are characteristically low Mach number
(Ma) in the deep interior.
Explicit timestepping methods which are bound by the Courant-Friedrich-Lewy
(CFL) timestep limit must resolve the fastest motions (sound
waves), resulting in timesteps which are prohibitively
small for studies of the deep, low-Ma motions. These systems are numerically
stiff, and the difference between
the sound crossing time and the convective overturn time have made studies of low-Ma stellar
convection difficult. Traditionally, approximations such as
the anelastic approximation, in which sound waves are explicitly filtered out,
have been used to study low-Ma flows \cite{brown&all2010, featherstone&hindman2016}.
More recently, advanced numerical techniques which use implicit or mixed
implicit-explicit timestepping mechanisms have made it feasible to study
convection at low Mach numbers \cite{viallet&all2011, viallet&all2013, viallet&all2016, lecoanet&all2014,
anders&brown2017, bordwell&all2018}, and careful studies of deep convection which
would have been impossible a decade ago are now widely accessible.

While solutions to the problem of divergent \emph{dynamical} timescales have proven useful,
the difference between convective timescales and thermal timescales, which
characterize system relaxation, remain a significant problem facing studies of convection. 
Solar convection is a prime example of this phenomenon;
dynamical timescales in the solar convective zone are relatively short 
(10 min overturn at solar surface, one month solar
rotation rate) compared to the Kelvin-Helmholtz timescale of
$3 \cdot 10^7$ years \cite{stix2003}.  
In such a system, it is impossible to resolve the convective dynamics while also
evolving the thermal structure of the system in a meaningful fashion.
As modern simulations aim to model natural convection
by increasing into the high-Rayleigh-number (Ra) regime,
the ratio of the thermal diffusion timescale to dynamical timescales
grows \cite{anders&brown2017}.
Furthermore, as dynamical and thermal timescales separate, 
simulations become more turbulent. Increasingly turbulent motions 
require finer grid meshes and smaller timesteps
to capture advective dynamics. Thus, the progression of simulations into the high-Ra
regime of natural convection is slowed by two simultaneous effects: timestepping
through a single convective overturn time becomes more computationally expensive
while the number of overturn times required for systems to reach thermal equilibration
grows.

The vast difference between convective and thermal timescales has long plagued
numericists studying convection, and an abundance of approaches has been employed to
study thermally converged solutions. One popular method for accelerating the convergence
of high-Ra solutions is by ``bootstrapping'' -- the process of using the flow
fields in a converged solution at lower Ra as initial conditions for a simulation at a higher
Ra.  This method has been used with great success \cite{johnston&doering2009, verzicco&camussi1997},
but it is not without its faults.  Bootstrapped solutions are succeptible to hysteresis
effects, in which large-scale convective structures present in the
low Ra solution imprint onto the dynamics of the new, high Ra solution. 
Another commonly-used tactic in
moderate-Ra simulations is to use 
a simple model of the full convective state as initial conditions.  
For example, past studies have used a linear eigenvalue solve to set the initial
convective state \cite{hurlburt&all1984} or used an axisymmetric solution 
as initial conditions for convection in a 3D cylinder \cite{verzicco&camussi1997}. 
In certain systems, 
the approximate state of the evolved solution can be estimated. There, an
appropriate set of initial conditions can either be solved for analytically
\cite{couston&all2017} or by using knowledge of Mixing Length Theory or other convective
theories to adjust the initial profile towards the proper adiabatic state \cite{brandenburg&all2005}.

Despite the numerous methods that have been used,
the most straightforward way to achieve a thermally converged solution
is to evolve a convective simulation through a thermal timescale. Some modern
studies do just that \cite{featherstone&hindman2016}, but it is becoming
increasingly difficult. Such evolution is
\emph{expensive}, and state-of-the-art simulations at the highest values of Ra
can only be reasonably run
for tens to hundreds of buoyancy times \cite{stevens&all2011}, much less the
thousands of buoyancy timescales required for thermal convergence.

In this work, we study a method of achieving accelerated evolution of a
convective simulation through adjusting the thermodynamic state using information 
from resolved, convective dynamics. We couple measurements of the (non-converged)
convective solution with knowledge about energy balances in the eventual solution
to self-consistently adjust the mean thermodynamic profile towards its final state. 
While such a method has been used previously \cite{hurlburt&all1986}, 
we find no explanation in the current literature of the steps involved in employing
this method, nor any study into the accuracy of such a method.
In section \ref{sec:experiment}, we describe our convective simulations, our
numerical methods, and our method for achieving accelerated evolution. In
section \ref{sec:results}, we compare solutions reached through the accelerated evolution
method to those that have been evolved through a full diffusive timescale, and we
examine select simulations at very high Ra which have achieved accelerated evolution. Finally,
in section \ref{sec:extensions}, we discuss extensions of the methods presented here,
and we offer concluding remarks in section \ref{sec:conclusion}.


%%%%%%%%%%%%
%%%%%%%%%%%
% EXPERIMENT
%%%%%%%%%%%
%%%%%%%%%%%%

\section{Experiment}
\label{sec:experiment}
We study incompressible \RB convection under the Oberbeck-Boussinesq approximation,
such that our fluid
has a constant kinematic viscosity ($\nu$), thermal diffusivity ($\kappa$), and coefficient
of thermal expansion ($\alpha$). The density of the fluid is a constant, $\rho_0$, except on the
term where the constant gravitational acceleration, $\bm{g} = - g\hat{z}$, acts in the vertical momentum equation, 
where $\rho = \rho_0(1  - \alpha T_1)$.  
Under these constraints, the equations of motion are \cite{spiegel&veronis1960}
\begin{gather}
\DivU = 0, 
	\label{eqn:incompressible}
\\
\frac{\partial \bm{u}}{\partial t} + \bm{u}\cdot\grad\bm{u} =
-\frac{1}{\rho_0}\grad P - g( 1 - \alpha T_1)\hat{z} + \nu\grad^2\bm{u}, 
	\label{eqn:dim_bouss_momentum}
\\
\frac{\partial T_1}{\partial t} + \bm{u}\cdot\grad(T_0 + T_1) = \kappa\grad^2 T_1,
	\label{eqn:dim_bouss_energy}
\end{gather}
where $\bm{u} = u\hat{x} + v\hat{y} + w\hat{z}$ is the velocity, 
$T = T_0 + T_1$ are the initial and fluctuating components of temperature, 
and $P$ is the pressure.
We non-dimensionalize these equations such that the dimensionless unit of
length is the layer height ($L_z$),
temperature is in units of the initial temperature jump across the layer ($\Delta T_0 = L_z \grad T_0$), 
and velocity is in units of the freefall velocity ($v_{\text{ff}} = \sqrt{\alpha g L_z^2 \grad T_0}$).
by these choices, one time unit is a freefall time ($L_z/v_{ff}$).
We introduce a reduced kinematic pressure,
$\varpi \equiv P / \rho_0 + \phi + |\bm{u}|^2 / 2$, where the gravitational
potential, $\phi$, is defined such that $\bm{g} = -\grad \phi$. As $P$ is a
Langrange multiplier under the Oberbeck-Boussinesq approximation, $\varpi$
can be treated straightforwardly as a linear variable. 
In non-dimensional form, Eqns. \ref{eqn:dim_bouss_momentum} \& \ref{eqn:dim_bouss_energy}
become
\begin{gather}
\frac{\partial \bm{u}}{\partial t} + \grad \varpi - T_1\hat{z} + \mathcal{R}\grad\times\bm{\omega} = \bm{u}\times\bm{\omega},
	\label{eqn:bouss_momentum}
\\
\frac{\partial T_1}{\partial t} - \mathcal{P}\grad^2 T_1 + w \frac{\partial T_0}{\partial z} = - \bm{u}\cdot\grad T_1.
	\label{eqn:bouss_energy}
\end{gather}
where $\bm{\omega} = \grad \times \bm{u}$ is the vorticity.
The dimensionless control parameters $\mathcal{P}$ and $\mathcal{R}$ 
are set by the Rayleigh and Prandtl numbers,
\begin{equation}
\mathcal{R} \equiv \sqrt{\frac{\text{Pr}}{\text{Ra}}}, \qquad \mathcal{P} \equiv \frac{1}{\sqrt{\text{Pr}\,\text{Ra}}}, \qquad
\text{Ra} = \frac{g \alpha L_z^4 \grad T_0}{\nu\kappa} = \frac{(L_z\,v_{\text{ff}})^2}{\nu\kappa}, \qquad \text{Pr} = \frac{\nu}{\kappa}.
\end{equation}
We hold Pr$ = 1$ constant throughout this work, such that $\mathcal{P} = \mathcal{R}$.

We study 2D and 3D convection in which the domain is a cartesian box, 
whose dimensionless vertical extent is $z \in [-1/2, 1/2]$, 
and which is horizontally periodic with an extent of $x, y \in [0, \Gamma]$ where $\Gamma = 2$ is the aspect
ratio. 
In the 2D cases, we set $v = \partial_y = 0$.
We specify no-slip, impenetrable boundary conditions at both the top and
bottom boundary and we use mixed thermal boundary conditions, such that
\begin{equation}
u = v = w = 0 \, \, \text{at}\,\,z = \pm 1/2, \qquad T_1 = 0 \,\,\text{at}\,\, z=+1/2, \qquad
\frac{\partial T_1}{\partial z} = 0\,\,\text{at}\,\,z=-1/2.
\label{eqn:bcs}
\end{equation}
For this choice of boundary conditions, the critical value of Ra at which
the onset of convection occurs is Ra$_{\text{crit}} = 1295.78$, and the
supercriticality of a run is defined as $S \equiv \text{Ra}/\text{Ra}_{\text{crit}}$.
Studies of convection which aim to model
astrophysical systems such as stars often employ mixed thermal
boundary conditions \cite{hurlburt&all1984, cattaneo&all1991, korre&all2017},
as we do here; however, our choice of thermal boundary conditions here
reflects the fact that the conditions in Eqn. \ref{eqn:bcs} are the simplest
to implement in the process of accelerated evolution (see section \ref{subsection:ae})
we study here.

We utilize the 
Dedalus\footnote{\url{http://dedalus-project.org/}} 
pseudospectral framework \cite{burns&all2016} to evolve  
Eqns. (\ref{eqn:incompressible}), (\ref{eqn:bouss_momentum}), \& (\ref{eqn:bouss_energy}) 
forward in time
using an implicit-explicit (IMEX), third-order, four-step 
Runge-Kutta timestepping scheme RK443 \cite{ascher&all1997}.  
The linear terms (on the LHS of the equations) are solved implicitly,
while the nonlinear terms (RHS) are explicitly solved.
Variables are time-evolved on a dealiased Chebyshev (vertical)
and Fourier (horizontal, periodic) domain in which the
physical grid dimensions are 3/2 the size of the coefficient grid.  

As initial conditions, we fill $T_1$ with
random white noise whose magnitude is $10^{-6}\mathcal{P}$.
This ensures that the initial perturbations are much smaller than the
evolved convective temperature perturbations, even at large Ra.
We filter this noise spectrum in coefficient space, 
such that only the lower 25\% of the coefficients
have power.


%%%%%%%%%%%%
%%%%%%%%%%%
% AE METHOD
%%%%%%%%%%%
%%%%%%%%%%%%

\subsection{The method of accelerated evolution}
\label{subsection:ae}
Here we describe a method of Accelerated Evolution (AE). We use this method to quickly evolve the
thermodynamic state of our solutions.  We compare this method to Standard Evolution
(SE), in which we naively evolve the atmosphere for one thermal diffusion time,
$t_\kappa = \mathcal{P}^{-1}$. As Ra increases, SE solutions become intractable, 
while the timeframe of convergence for an AE solution remains nearly constant
(in units of freefall times).
For an example of time saving achieved by using AE, we compare
energy traces at $S = 10^5$ from a SE run in Fig \ref{fig:time_trace}a to an AE run
in Fig. \ref{fig:time_trace}b.

The horizontally averaged profiles of the vertical conductive flux, 
F$_{\text{cond}} = \angles{-\kappa\grad(T_0 + T_1)}_{x,y}$, and the vertical convective flux,
F$_{\text{conv}} = \angles{w(T_0 + T_1)}_{x,y}$, where $\angles{}_{x,y}$ represent
a horizontal average, are the basis of the AE method. We measure
both of these quantities early in a simulation, as in Fig. \ref{fig:time_trace}c.
At these early stages in the simulation, these flux profiles are highly asymmetric,
with much more flux leaving through the upper boundary than entering through the
lower boundary as the atmosphere approaches the proper isotherm selected by the
fixed temperature upper boundary condition.
However, by calculating the total flux,
F$_{\text{tot}} = $F$_{\text{conv}} +$ F$_{\text{cond}}$, and then calculating the profiles
\begin{equation}
f_{\text{conv}}(z) = \frac{F_{\text{conv}}}{F_{\text{tot}}},\qquad
f_{\text{cond}}(z) = \frac{F_{\text{cond}}}{F_{\text{tot}}},
\label{eqn:bvp_ratios}
\end{equation}
we remove the asymmetry and examine which parts of the atmosphere are dominated
by conduction, and which are not.
We presume that the early convection occupies roughly the same volume as the evolved
convection, and thus that the early thermal boundary layers are roughly the proper
width.  Where $f_{\text{conv}} = 1$, convection dominates all transport, and where
$f_{\text{cond}} = 1$, conduction dominates all transport (in the boundary
layers). Under this assumption, the proper evolved atmospheric flux profiles
are F$_{\text{conv, ev}} = \text{F}_{\text{bot}}\cdot f_{\text{conv}}$
and F$_{\text{cond, ev}} = \text{F}_{\text{bot}}\cdot f_{\text{cond}}$,
where F$_{\text{bot}} = \mathcal{P}$ is the amount of flux entering the
bottom of the atmosphere.

\begin{figure}[t]
\includegraphics[width=\textwidth]{./figs/time_trace.png}
\caption{Traces of kinetic energy and mean temperature vs. time for a (a) SE and (b)
AE run are shown at $S = 10^5$.
The horizontal extent of the plots is set
such that one simulation time unit takes up an equal amount of paper space in (a) and (b).
The mean evolved values are shown as horizontal dashed lines.
(c) System fluxes shortly after the convective transient are shown, at times corresponding
to the orange highlighting in (a) and (b).  The sum of the flux is shown in black,
the convective flux is shown in purple, and the conductive flux is shown in red.
(d) Fluxes in the evolved AE state are shown, measured during the time highlighted
in green in (b).  
(e) The difference between the AE and SE fluxes, measured over the green highlighted
regions in (a) and (b), are shown.
Note that the black dashed vertical line in (a) denotes the simulation time at which
averaging begins for the AE solution shown in (b).
\label{fig:time_trace} }
\end{figure}



In the evolved, time-stationary state, the horizontal- and time-average of
Eqns. (\ref{eqn:bouss_momentum}) and (\ref{eqn:bouss_energy}), neglecting terms that
vanish due to symmetry, are
\begin{gather}
\frac{\partial}{\partial z}\angles{\varpi}_{x,y} - \angles{T_1}_{x,y}\hat{z} = \angles{\bm{u}\times\bm{\omega}}_{x,y},
	\label{eqn:bouss_BVP_momentum}
\\
\frac{\partial}{\partial z}\text{F}_{\text{conv, ev}} - \mathcal{P}\frac{\partial^2}{\partial z^2} \angles{T_1}_{x,y} = 0.
	\label{eqn:bouss_BVP_energy}
\end{gather}
Convective flows
are perturbations around a thermal profile defined by these equations in the proper evolved, 
statistically stationary state. Furthermore, under the specification of
F$_{\text{conv, ev}}$ and $\angles{\bm{u}\times\bm{\omega}}_{x,y}$,
\emph{the mean thermodynamic structure of the system} ($\angles{\varpi}_{x,y},\,\angles{T_1}_{x,y}$)
\emph{is fully specified}.

The AE method is thus simple: we construct F$_{\text{conv, ev}}$ as described above.
Then we calculate a profile, 
$\xi(z) = \text{F}_{\text{conv, ev}}/\text{F}_{\text{conv}}$, which is the amount that the
flux in the system needs to be reduced by, as a function of height.
We multiply the velocities
and the thermal fluctuations, $T - \angles{T}$, by $\sqrt{\xi}$, such that the product of all fluctuations
(which carry the convective flux) are diminished by a factor of $\xi$.  We solve
Eqns. (\ref{eqn:bouss_BVP_momentum}-\ref{eqn:bouss_BVP_energy}) with F$_{\text{conv, ev}}$
and $\xi\cdot\angles{\bm{u}\times\bm{\omega}}_{x,y}$ for the mean thermodynamic state,
and then continue evolving in time.  This adjustment of the mean profile and the
diminishing of velocities and fluctuations is the AE method, and it can generally
be applied tens of buoyancy times after the peak of convective transient.
For specifics on the precise implementation of the AE method, we refer
the reader to appendix \ref{appendix:recipe}.

The AE method specified here quickly converges the fluxes within the
system to within a few percent of the fluxes in a system converged through
SE (Fig. \ref{fig:time_trace}d \& e).


%%%%%%%%%%%%
%%%%%%%%%%%
% RESULTS
%%%%%%%%%%%
%%%%%%%%%%%%

\section{Results}
\label{sec:results}
We study evolved solutions achieved through the SE method from convective onset
up to $S = 10^5$ in 2D and $S = 10^4$ in 3D.  These SE runs are compared to
AE runs spanning from onset up to $S = 10^7$ in 2D and $S = 10^4$ in 3D.
For a full list of simulations, we refer the reader to appendix \ref{appendix:run_table}.

We report the time- and volume-averaged values of select measurements of the
evolved solutions in Fig. \ref{fig:parameter_space_comparison}.  We report
the scaling of heat transport in the evolved solution, as quantified by the
Nusselt number, in Fig. \ref{fig:parameter_space_comparison}a.
The volume averaged Nusselt number is defined as
\begin{equation}
\text{Nu} = \frac{\angles{F_{\text{conv}} + F_{\text{cond}}}}{\angles{F_{\text{cond, ref}}}}
 = \frac{\angles{wT - \mathcal{P}\partial_z T}}{\angles{- \mathcal{P} \partial_z T}}.
\end{equation}
In 3D and in 2D when $S < 10^{3+2/3}$, the evolved system is defined by a clear
value of Nu and the convection reaches a statistically stationary state.
In 2D and at larger values of $S$, the value of Nu oscillates as a function of time
as the plumes in the solution oscillate horizontally.  Our choice of no-slip
boundary conditions prevent the fluid from entering a full-fledged shearing state
\cite{goluskin&all2014}, but the oscillatory motions which do arise cause the
system to vary between periods of low heat transport and high heat transport.
The SE simulations which span up to $S = 10^5$ exhibit the same horizontally
oscillatory motion as the AE solutions for the same initial conditions. The
scaling of the mean value of Nu is roughly $\text{Nu} \propto \text{Ra}^{1/5}$,
weaker than that reported in similar systems with fixed-T and fixed-flux boundary
conditions \cite{johnston&doering2009}.  We attribute this weaker Nu scaling to
the oscillatory nature of the plumes, which may have been avoided by previous studies
using bootstrapping techniques as initial conditions.

In Fig. \ref{fig:parameter_space_comparison}b, we report the rms Reynolds number
in the AE solutions, where
$\text{Re} = \angles{|\bm{u}|} / \mathcal{R}$.  This measure scales roughly as
$\text{Re} \propto \text{Ra}^{0.45}$, and shows little variance with time.

In Fig. \ref{fig:parameter_space_comparison}c, we report the volume averaged 
temperature of the AE solutions, with the value at the upper (fixed $T$) boundary removed.
This measurement probes the thickness of the boundary layers of the solutions, and
should show scaling which is inversely proportional to Nu in converged solutions
where fixed-flux boundary conditions are used \cite{otero&all2002}.  We find here
that $(\angles{T} - T_{\text{top}}) \propto \text{Ra}^{-1/5}$, precisely the inverse
scaling of Nu, giving confidence that these solutions are in a converged state.

In Fig. \ref{fig:parameter_space_comparison}d-f, we report the fractional difference
between measurements from the AE solutions and measurements from the SE solutions.
We find that the mean value of Nu from AE solutions is accurate to the values
from SE solutions to within $\sim 1$\%, and the same is true for $\angles{T}$ measurements.
Re measurements show slightly greater error, with AE measurements being on average
$\leq 2$\% away from the SE measurements. 

\begin{figure}[t]
\includegraphics[width=\textwidth]{./figs/parameter_space_comparison.png}
\caption{Volume- and time-averaged measurements for AE runs are shown in (a)-(c).
Symbols are located at the mean value of
each measurement, while vertical lines represent the standard deviation of the measurement,
showing natural variation over the
averaging window, and error bars represent the change in the mean value over the window,
such that large error bars would represent a poorly converged solution.
(a) The Nusselt number scales as $Ra^{1/5}$, and above S$\geq 10^{3+2/3}$,
simulations exhibit oscillating plume structures whose heat transport varies over time.  
(b) The RMS Reynolds number, which measures the level of turbulence in the evolved solution, scales as
Ra$^{0.45}$. (c) Temperature, with its value at the upper boundary removed, is shown.
Relative error for (d) Nu, (e) Re, and (f) $T$ are shown between measurements 
taken in AE solutions and SE solutions.
The greyed area of the plot indicates the region in which only AE runs were
carried out due to computational expense. The run at $S = 10^5$ marked as a
black square is examined in more details in Figs. \ref{fig:time_trace},
\ref{fig:temp_comparison}, \& \ref{fig:pdf_comparison}.
\label{fig:parameter_space_comparison} }
\end{figure}

The measurements presented in Fig. \ref{fig:parameter_space_comparison} demonstrate
that the AE method can be powerfully employed in parameter space studies in which
large numbers of simulations are compared in a volume-averaged sense.  We now turn
our examination to a more direct comparison of AE and SE for convection at
$S = 10^5$, as has been introduced in Fig. \ref{fig:time_trace}.

As the AE method primarily serves to adjust the thermodynamic structure of the
solution, we compare the temperature profile attained by AE and SE in 
Fig. \ref{fig:temp_comparison}.  We see that the boundary layer length scale is 
nearly identical in the AE and SE solution (Fig. \ref{fig:temp_comparison}a), but that
the mean temperature in the interior differs by about 0.5\% on average
(Fig. \ref{fig:temp_comparison}b). The probability distribution function of point-by-point
temperature values are compared in Fig. \ref{fig:temp_comparison}c.  We construct
this PDF by interpolating our temperature field onto a regular grid, determing the
frequency distribution of all $T$ values, and then properly normalizing such that
the integral of the PDF is unity.  In addition to the
difference in mode which can be seen in the mean vertical profile, the SE case
has a broader spread of temperature values.  This can likely be attributed to the
slight overstabilization of the temperature profile obtained by the AE method
(as can be seen in Fig. \ref{fig:time_trace}a\&b).  One means of comparing two
probability distributions to determine if they are drawn from the same underlying
sample is through the use of a Kolmogorov-Smirnov (KS) \cite{wall&jenkins2012}.
In general, a KS test must be conducted on independent, uncorrelated data, which
poorly describes the point-by-point values of flow in a fluid simulation. Thus,
we will merely use the KS statistic, the maximum difference
between the cumulative distribution functions (CDFs) of the two sample distributions,
as a numerical method of directly comparing the two PDFs.  For the distributions
shown in Fig. \ref{fig:temp_comparison}c,
we find a KS statistic of 0.185 near the modes, which is large, and implies that
these two distributions are different.




\begin{figure}[t]
\includegraphics[width=\textwidth]{./figs/temp_comparison.png}
\caption{Comparisons of the evolved thermodynamic states of an AE and SE run
at $S = 10^{5}$ are shown.  (a) Evolved temperature profiles, as a function of height.
(b) The percentage difference between the temperature profiles as a function of height.
(c) Probability distributions of point-by-point measurements of the temperature field.
$T$ is sampled every 0.1 time units for 500 total time units,
and was interpolated onto an evenly spaced grid before sampling.
The cumulative distribution function is overplotted on each plot. 
\label{fig:temp_comparison} }
\end{figure}

In addition to comparing the thermodynamic state achieved by the SE and AE methods,
we examine the velocities found in the evolved states.
We compute PDFs in the same manner as in Fig. \ref{fig:temp_comparison}c for the
vertical velocity (Fig. \ref{fig:pdf_comparison}a), horizontal velocity (Fig. \ref{fig:pdf_comparison}b),
and the nonlinear convective flux (Fig. \ref{fig:pdf_comparison}c). We report KS statistics
of 0.00615, 0.0349, and 0.0204, respectively.  Perhaps unsurpisingly, the nonlinear
convective transport between the SE and AE methods are very similar, as is captured
in a volume-averaged sense in the Nu measurements of Fig. \ref{fig:parameter_space_comparison}a\&d).
In general, the velocity boundary conditions (Eqn. \ref{eqn:bcs}) more strongly dominate the flow
fields for the SE cases than the AE cases in Fig. \ref{fig:pdf_comparison}a\&c. 
This suggests that the velocity boundary layers are not yet fully formed in the
AE solutions. However, aside from this difference, the two solutions show a similar
distribution of realized velocity values.

\begin{figure}[b]
\includegraphics[width=\textwidth]{./figs/pdf_comparison.png}
\caption{Probability distribution functions of (a) the vertical velocity, (b) the horizontal velocity, and (c) nonlinear
convective transport are shown for a 2D runs achieved through the SE and AE methods
at $S = 10^{5}$.  Flows are sampled every 0.1 time units for 500 total time units,
and flows are interpolated onto an evenly spaced grid before sampling.
The cumulative distribution function is overplotted on each plot. 
\label{fig:pdf_comparison} }
\end{figure}


Despite differences between the SE and AE solutions for the case studied in 
Figs. \ref{fig:time_trace}, \ref{fig:temp_comparison}, \& \ref{fig:pdf_comparison},
the AE method is still extremely powerful.  The first application of the AE method
($t \approx 70$ in Fig. \ref{fig:time_trace}b) immediately increases the 
average time step of our solver by a factor of 2-3. At higher supercriticality
($S = 10^7$), the AE solve immediately boosts the timestep by nearly a factor of 4.
Thus, not only does this method evolve the solution into nearly the correct state, 
but further time evolution (either to achieve precisely the correct thermodynamic
state or to take measurements of fluid quantities) happens more efficiently.


%%%%%%%%%%%%
%%%%%%%%%%%
% CONCLUSION
%%%%%%%%%%%
%%%%%%%%%%%%


\section{Extensions \& Conclusion}
\label{sec:extensions}
In this work we have used \RB convection as a test case for the AE method, but we argue that
the true power of this method is in its extensions to more complicated studies.
Such extensions are beyond the scope of this paper, but we will briefly describe
areas in which extensions to the AE method should be explored.
We note that a strength of the AE method is its generality.  One
need only derive the steady-state, horizontally-averaged equations for a given
equation set (e.g., Eqns. (\ref{eqn:bouss_BVP_momentum}) \& (\ref{eqn:bouss_BVP_energy}))
and couple that information with knowledge of the current dynamics (Eqn. (\ref{eqn:bvp_ratios}))
and the boundary conditions. Thus this method can be easily applied to more complex
systems, so long as the experimenter understand the energy transport
present in their systems.

In studies of stratified convection where the thermal diffusivity
is inversely proportional to the density \cite{anders&brown2017}, the
thermal timescale deep in the atmosphere is much larger than the timescale
near the surface.  Thus, the AE method can be a very important tool for studying
highly stratified systems which aim to model realistic astrophysical atmospheres.
Through carefully examining the flux in excess of the flux conducted along the
adiabatic temperature gradient, the fractions of Eqn. (\ref{eqn:bvp_ratios})
can be constructed for such a system.  In addition to solving for the average
hydrostatic balance and thermal equilibrium, it is essential to simultaneously
ensure that mass is conserved in truly stratified systems by adding a 
mass-conservation equation, similar to those used in stellar structure models
\cite{paxton&all2011}.

It is common for studies to pair stable and convecting regions
\cite{hurlburt&all1986, brandenburg&all2005, couston&all2017}.
In such studies, particularly when the interface between the stable region
and the convecting region is stiff and motions do not penetrate from the convecting
region into the stable region, the stable region cannot rely on convective
motions to assist in the restratification of the thermal profile.
In fully-convective domains, such as those studied here, the atmosphere evolves
much more rapidly than the thermal diffusion time (see e.g., Fig. \ref{fig:time_trace}a,
where the SE solution is essentially fully converged after $4\cdot 10^3$ frefall units
despite the thermal timescale being roughly $10^4$ frefall units).

We have only studied solutions in which we use mixed thermal boundary conditions,
as in Eqn. \ref{eqn:bcs}. However, this method can be easily applied to fixed-temperature
boundary conditions, as well.  Rather than knowing the total final flux (F$_{\text{bot}}$)
through the system a priori, it must be measured using the ratios in
Eqn. \ref{eqn:bvp_ratios}.  The integrated conductive flux is known in these systems exactly thanks 
to the fixed temperature jump across the domain.  The total flux through the system
($F_{\text{bot}}$) can is thus $\mathcal{P} / \int f_{\text{cond}} dz$ (double-check).
We hesitate to use the AE method for systems in which
both boundaries fix the flux, as such systems have degenerate solutions for the temperature.

In conclusion, here we have described a method for converging convective simulations using
a method of Accelerated Evolution (AE), and compared it to Standard
Evolution (SE) achieved by running simulations for a thermal timescale.
We have shown that the AE method produces dynamics that are similar to SE
dynamics on much shorter timescales, and have discussed differences that arise
between the two methods.

We have shown that the AE method is valid at low values of $S$, in which solutions
converge quickly, and at high values of $S$, at which SE solutions can take an
intractable amount of time.  This shows that the AE method not only progresses
solutions towards the correct evolved state (at high $S$), but it also does not
throw the simulation out of the correct evolved state (at low $S$).  We have studied
the AE method in both 2D and 3D, but since the method relies fundamentally on
1D information from the transient flows, we have restricted most of our study
to 2D and merely demonstrated the method's efficacy in 3D, too.

This work serves as a first step towards creating robust methods for
achieving evolved convective solutions at high Ra on short timescales.
Future studies will extend this method to stratified, fully compressible
convection \cite{anders&brown2017}, and to systems with internal heating.


\begin{acknowledgments}
EHA acknowledges the support of the University of Colorado's George 
Ellery Hale Graduate Student Fellowship.
This work was additionally supported by  NASA LWS grant number NNX16AC92G.  
Computations were conducted 
with support by the NASA High End Computing (HEC) Program through the NASA 
Advanced Supercomputing (NAS) Division at Ames Research Center on Pleiades
with allocations GID s1647 and GID g26133.
\end{acknowledgments}


\appendix
\section{Accelerated Evolution Recipe}
\label{appendix:recipe}
In order to achieve Accelerated Evolution (AE), we solve a 1D Boundary Value Problem
consisting of Eqns. (\ref{eqn:bouss_BVP_momentum}) \& (\ref{eqn:bouss_BVP_energy}).
There are a steps required to properly advance the solution are as follows:
\begin{enumerate}
\item Update averages of $F_{\text{conv}}$, $F_{\text{tot}}$, and $\angles{\bm{u} \times \bm{\omega}}$
every timestep.  Wait until that average converges. To ensure that an average is converged, at
least some time $t_{\text{min}}$ must have passed since the average was started, and
the profiles must change by no more than $P$\% on a given timestep.
\item Construct F$_\text{conv, ev}$ and $\xi$ as specified in section \ref{subsection:ae}.
\item Solve for $\angles{T_1}_{x,y}$ and $\angles{\varpi}_{x,y}$ of the
evolved state.  Adjust the profiles in the convecting simulation accordingly
\item Multiply the velocity field and the fluctuations in $T - \angles{T}_{x,y}$ by $\sqrt{\xi}$ in the IVP. 
\item Continue running the simulation.
\end{enumerate}
We refer to this process as an ``AE BVP solve.''

In general, we find that repeating this method multiple times is the best way to
ensure that the AE solution is truly converged. For all runs in 2D at $S < 10^5$, we
waited for 50 time units after peak transient, completed an AE BVP solve
with $t_{\text{min}} = 30$ and $P = 0.1$, waited 50 more time units, and then
did a second AE BVP solve with the same parameters.
For all 3D runs and 2D runs in the range $S \in [10^5, 10^6]$,
we waited 20 time units after peak transient, completed an AE BVP solve
with $t_{\text{min}} = 20$ and $P = 1$ in order to quickly reach a near-
converged state and vastly increase our timestep.  After this, we completed
two AE BVP solves, separated by 30 time units each, with $t_{\text{min}} = 30$
and $P = 0.1$ to get very close to the solution (as in Fig. \ref{fig:time_trace}b).
At very high $S = 10^7$, we ran two AE BVP solves with $t_{\text{min}} = 20$ and
$P = 1$, waiting 20 time units after peak transient and 30 time units between
the two solves.




\section{Table of Runs}
\label{appendix:run_table}
\begin{center}
\begin{tabularx}{\textwidth}{ X X X X X X X X X }
\hline															
$S$	&	Ra	&	nz	&	nx, ny	&	$t_{\text{therm}}$	&	$t_{\text{avg}}$	&	Nu$_{\text{SE}}$	&	Nu$_{\text{AE}}$	\\
\hline															
$10^{1/3}$	&	$2.79 \cdot 10^3$	&	32	&	64	&	$52.8$	&	100	&	1.46	&	1.46	\\
$10^{2/3}$	&	$6.01 \cdot 10^3$	&	32	&	64	&	$77.6$	&	100	&	1.95	&	1.95	\\
$10^1$	&	$1.30 \cdot 10^4$	&	32	&	64	&	$114$	&	100	&	2.43	&	2.42	\\
$10^{1 + 1/3}$	&	$2.79 \cdot 10^4$	&	32	&	64	&	$167$	&	100	&	2.54	&	2.54	\\
$10^{1 + 2/3}$	&	$6.01 \cdot 10^4$	&	32	&	64	&	$245$	&	100	&	3.14	&	3.14	\\
$10^2$	&	$1.30 \cdot 10^5$	&	64	&	128	&	$360$	&	100	&	3.8	&	3.8	\\
$10^{2 + 1/3}$	&	$2.79 \cdot 10^5$	&	64	&	128	&	$528$	&	100	&	4.71	&	4.71	\\
$10^{2 + 2/3}$	&	$6.01 \cdot 10^5$	&	64	&	128	&	$776$	&	100	&	5.5	&	5.5	\\
$10^3$	&	$1.30 \cdot 10^6$	&	128	&	256	&	$1.14 \cdot 10^3$	&	200	&	6.4	&	6.33	\\
$10^{3 + 1/3}$	&	$2.79 \cdot 10^6$	&	128	&	256	&	$1.67 \cdot 10^3$	&	500	&	6.87	&	6.95	\\
$10^{3 + 2/3}$	&	$6.01 \cdot 10^6$	&	256	&	512	&	$2.45 \cdot 10^3$	&	500	&	7.54	&	7.59	\\
$10^4$	&	$1.30 \cdot 10^7$	&	256	&	512	&	$3.60 \cdot 10^3$	&	500	&	8.83	&	8.83	\\
$10^{4 + 1/3}$	&	$2.79 \cdot 10^7$	&	256	&	512	&	$5.28 \cdot 10^3$	&	500	&	10.13	&	10.14	\\
$10^{4 + 2/3}$	&	$6.01 \cdot 10^7$	&	256	&	512	&	$7.76 \cdot 10^3$	&	500	&	11.65	&	11.69	\\
$10^5$	&	$1.30 \cdot 10^8$	&	512	&	1024	&	$1.14 \cdot 10^4$	&	500	&	14.02	&	14.18	\\
$10^{5 + 1/3}$	&	$2.79 \cdot 10^8$	&	512	&	1024	&	$1.67 \cdot 10^4$	&	500	&	--	&	16.21	\\
$10^{5 + 2/3}$	&	$6.01 \cdot 10^8$	&	512	&	1024	&	$2.45 \cdot 10^4$	&	500	&	--	&	18.58	\\
$10^6$	&	$1.30 \cdot 10^9$	&	1024	&	2048	&	$3.60 \cdot 10^4$	&	500	&	--	&	22.13	\\
$10^7$	&	$1.30 \cdot 10^{10}$	&	2048	&	4096	&	$1.14 \cdot 10^5$	&	200	&	--	&	40.78	\\
\\ \hline \hline \\															
$10^1$	&	$1.30 \cdot 10^4$	&	32	&	64$\times$64	&	$114$	&	100	&	2.42	&	2.42	\\
$10^2$	&	$1.30 \cdot 10^5$	&	64	&	128$\times$128	&	$360$	&	100	&	3.97	&	4	\\
$10^3$	&	$1.30 \cdot 10^6$	&	128	&	256$\times$256	&	$1.14 \cdot 10^3$	&	500	&	6.27	&	6.27	\\
$10^4$	&	$1.30 \cdot 10^7$	&	256	&	512$\times$512	&	$3.60 \cdot 10^3$	&	500	&	9.92	&	9.88	\\
\hline															
\end{tabularx}
\end{center}






\bibliography{biblio.bib}
\end{document}
